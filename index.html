<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoM HP Damage Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.95em;
        }

        .content {
            padding: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-weight: 600;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        .calc-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .calc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .calc-button:active {
            transform: translateY(0);
        }

        .results {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-label {
            font-weight: 600;
            color: #555;
        }

        .result-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
        }

        .result-value.uncapped {
            color: #764ba2;
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.9em;
            color: #856404;
        }

        .calculation-steps {
            background: #e8f4fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .calculation-steps h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .step {
            margin: 8px 0;
            color: #0d47a1;
        }

        .buff-indicator {
            color: #27ae60;
            font-weight: 600;
        }

        .debuff-indicator {
            color: #e74c3c;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>⚔️ Legend of Mushroom</h1>
            <p>HP-Based Damage Calculator</p>
        </div>

        <div class="content">
            <div class="input-section">
                <div class="section-title">Damage Configuration</div>
                <div class="input-group">
                    <label for="dmgType">HP Damage Type</label>
                    <select id="dmgType" onchange="toggleCustomScaling()">
                        <option value="playerMaxHP">Player Maximum HP</option>
                        <option value="playerCurrentHP">Player Current HP</option>
                        <option value="enemyMaxHP">Enemy Maximum HP</option>
                        <option value="enemyCurrentHP">Enemy Current HP</option>
                        <option value="enemyMaxHPPal">Enemy Maximum HP (Pal Dmg)</option>
                        <option value="customScaling">Custom Scaling</option>
                    </select>
                </div>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="hpPerc">HP Damage % (e.g., 5 for 5%)</label>
                        <input type="number" id="hpPerc" value="5" step="0.1" min="0">
                    </div>
                    <div class="input-group">
                        <label for="customScaling">Custom Scaling Multiplier (e.g., 2000 for 2000×)</label>
                        <input type="number" id="customScaling" value="2000" step="1" min="1" disabled>
                    </div>
                    <div class="input-group">
                        <label for="hpPercent">Target HP % (for Current HP types)</label>
                        <select id="hpPercent">
                            <option value="100">100%</option>
                            <option value="75">75%</option>
                            <option value="50">50%</option>
                            <option value="25">25%</option>
                            <option value="10">10%</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="section-title">Buffs & Debuffs</div>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="temporalCompression">
                        <label for="temporalCompression">Temporal Compression (+30% ATK)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="opponentBreezy">
                        <label for="opponentBreezy">Opponent Breezy (-20% ATK)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="gust">
                        <label for="gust">Gust (+15% ATK)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="coinBomb">
                        <label for="coinBomb">Coin Bomb (+35% Basic ATK Multiplier)</label>
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="section-title">Player Stats</div>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="playerATK">Player ATK (in Billions, e.g., 5 = 5B)</label>
                        <input type="number" id="playerATK" value="5" step="0.1" min="0">
                    </div>
                    <div class="input-group">
                        <label for="playerHP">Player HP (in Billions, e.g., 1500 = 1500B)</label>
                        <input type="number" id="playerHP" value="1500" step="1" min="0">
                    </div>
                    <div class="input-group">
                        <label for="playerBasicATKMult">Player Basic ATK Multiplier %</label>
                        <input type="number" id="playerBasicATKMult" value="5000" step="100">
                    </div>
                    <div class="input-group">
                        <label for="playerLevel">Player Level</label>
                        <input type="number" id="playerLevel" value="185" min="1" max="220">
                    </div>
                </div>
            </div>

            <div class="input-section">
                <div class="section-title">Enemy Stats</div>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="enemyDEF">Enemy DEF (in Billions, e.g., 2 = 2B)</label>
                        <input type="number" id="enemyDEF" value="2" step="0.1" min="0">
                    </div>
                    <div class="input-group">
                        <label for="enemyHP">Enemy HP (in Billions, e.g., 1500 = 1500B)</label>
                        <input type="number" id="enemyHP" value="1500" step="1" min="0">
                    </div>
                    <div class="input-group">
                        <label for="enemyLevel">Enemy Level</label>
                        <input type="number" id="enemyLevel" value="180" min="1" max="220">
                    </div>
                </div>
            </div>

            <button class="calc-button" onclick="calculate()">Calculate Damage</button>

            <div id="results" style="display: none;">
                <div class="results">
                    <div class="result-item">
                        <span class="result-label">Final HP Damage:</span>
                        <span class="result-value" id="finalDamage">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Final HP Damage %:</span>
                        <span class="result-value" id="finalDamagePercent" style="font-size: 1.1em;">0%</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Uncapped Damage (Infinite ATK):</span>
                        <span class="result-value uncapped" id="uncappedDamage">0</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Uncapped Damage %:</span>
                        <span class="result-value uncapped" id="uncappedDamagePercent" style="font-size: 1.1em;">0%</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">Damage Status:</span>
                        <span class="result-value" id="damageStatus" style="font-size: 1em;">-</span>
                    </div>
                </div>

                <div class="calculation-steps" id="calcSteps"></div>

                <div class="info-box">
                    <strong>Note:</strong> HP-based damage cannot be reduced by resistances and cannot be critical. 
                    The damage is capped between minimum (0.8 × Basic ATK DMG) and maximum (50×, 100×, 2000×, or Custom Scaling × Basic ATK DMG depending on HP type).
                </div>
            </div>
        </div>
    </div>

    <script>
        // PvP Damage Reduction Factors from the document
        const pvpReductionFactors = {
            1: 1.00, 2: 1.00, 3: 1.00, 4: 1.00, 5: 1.00, 6: 1.00, 7: 1.00, 8: 1.10, 9: 1.15, 10: 1.40,
            11: 1.60, 12: 1.70, 13: 2.00, 14: 2.10, 15: 2.40, 16: 2.50, 17: 2.55, 18: 2.95, 19: 3.05, 20: 3.45,
            21: 3.85, 22: 4.00, 23: 4.15, 24: 4.25, 25: 4.75, 26: 4.90, 27: 5.05, 28: 5.15, 29: 5.30, 30: 5.80,
            31: 6.45, 32: 6.60, 33: 6.75, 34: 6.95, 35: 7.65, 36: 7.80, 37: 7.95, 38: 8.15, 39: 8.35, 40: 8.50,
            41: 9.35, 42: 9.50, 43: 9.70, 44: 9.90, 45: 10.05, 46: 10.25, 47: 10.45, 48: 10.65, 49: 10.80, 50: 11.00,
            51: 11.95, 52: 12.15, 53: 12.35, 54: 12.55, 55: 12.75, 56: 12.95, 57: 13.15, 58: 13.35, 59: 13.55, 60: 13.75,
            61: 14.90, 62: 15.10, 63: 15.35, 64: 15.55, 65: 16.10, 66: 16.70, 67: 17.30, 68: 17.90, 69: 18.60, 70: 19.20,
            71: 19.90, 72: 20.70, 73: 21.40, 74: 22.20, 75: 23.00, 76: 23.90, 77: 24.80, 78: 25.70, 79: 26.60, 80: 27.60,
            81: 28.60, 82: 29.70, 83: 30.80, 84: 31.90, 85: 33.10, 86: 34.30, 87: 35.60, 88: 36.90, 89: 38.20, 90: 39.60,
            91: 41.10, 92: 42.60, 93: 44.20, 94: 45.80, 95: 47.50, 96: 49.20, 97: 51.00, 98: 52.90, 99: 54.90, 100: 56.90,
            101: 59.00, 102: 61.20, 103: 63.40, 104: 65.80, 105: 68.20, 106: 70.70, 107: 73.30, 108: 76.00, 109: 78.80, 110: 81.70,
            111: 84.70, 112: 87.80, 113: 91.10, 114: 94.40, 115: 97.90, 116: 101.50, 117: 105.20, 118: 109.10, 119: 113.10, 120: 117.30,
            121: 121.60, 122: 126.10, 123: 130.80, 124: 135.60, 125: 140.60, 126: 145.80, 127: 151.00, 128: 156.20, 129: 161.40, 130: 166.60,
            131: 172.00, 132: 177.40, 133: 182.80, 134: 188.20, 135: 193.60, 136: 199.20, 137: 204.80, 138: 210.40, 139: 216.00, 140: 221.60,
            141: 227.40, 142: 233.20, 143: 239.00, 144: 244.80, 145: 250.60, 146: 256.60, 147: 262.60, 148: 268.60, 149: 274.60, 150: 280.60,
            151: 286.70, 152: 292.80, 153: 298.90, 154: 305.00, 155: 311.20, 156: 317.40, 157: 323.60, 158: 329.80, 159: 336.00, 160: 342.30,
            161: 348.60, 162: 354.90, 163: 361.20, 164: 367.50, 165: 373.90, 166: 380.30, 167: 386.70, 168: 393.10, 169: 399.50, 170: 406.00,
            171: 412.50, 172: 419.00, 173: 425.50, 174: 432.00, 175: 438.60, 176: 445.20, 177: 451.80, 178: 458.40, 179: 465.00, 180: 471.70,
            181: 478.40, 182: 485.10, 183: 491.80, 184: 498.50, 185: 505.30, 186: 512.10, 187: 518.90, 188: 525.70, 189: 532.50, 190: 539.40,
            191: 546.30, 192: 553.20, 193: 560.10, 194: 567.00, 195: 574.00, 196: 581.00, 197: 588.00, 198: 595.00, 199: 602.00, 200: 609.00,
            201: 616.10, 202: 623.20, 203: 630.30, 204: 637.40, 205: 644.50, 206: 651.70, 207: 658.90, 208: 666.10, 209: 673.30, 210: 680.50,
            211: 687.80, 212: 695.10, 213: 702.40, 214: 709.70, 215: 717.00, 216: 724.40, 217: 731.80, 218: 739.20, 219: 746.60, 220: 754.00
        };

        function toggleCustomScaling() {
            const dmgType = document.getElementById('dmgType').value;
            const customScalingInput = document.getElementById('customScaling');
            
            if (dmgType === 'customScaling') {
                customScalingInput.disabled = false;
                customScalingInput.style.backgroundColor = 'white';
            } else {
                customScalingInput.disabled = true;
                customScalingInput.style.backgroundColor = '#f5f5f5';
            }
        }

        function formatNumber(num) {
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(2) + 'K';
            return num.toFixed(2);
        }

        function calculate() {
            const dmgType = document.getElementById('dmgType').value;
            const hpPerc = parseFloat(document.getElementById('hpPerc').value);
            const customScaling = parseFloat(document.getElementById('customScaling').value);
            const hpPercent = parseFloat(document.getElementById('hpPercent').value);
            
            let playerATK = parseFloat(document.getElementById('playerATK').value) * 1e9;
            const playerHP = parseFloat(document.getElementById('playerHP').value) * 1e9;
            let playerBasicATKMult = parseFloat(document.getElementById('playerBasicATKMult').value);
            const playerLevel = parseInt(document.getElementById('playerLevel').value);
            const enemyDEF = parseFloat(document.getElementById('enemyDEF').value) * 1e9;
            const enemyHP = parseFloat(document.getElementById('enemyHP').value) * 1e9;
            const enemyLevel = parseInt(document.getElementById('enemyLevel').value);

            // Get buff/debuff states
            const temporalCompression = document.getElementById('temporalCompression').checked;
            const opponentBreezy = document.getElementById('opponentBreezy').checked;
            const gust = document.getElementById('gust').checked;
            const coinBomb = document.getElementById('coinBomb').checked;

            // Apply buffs/debuffs
            let atkModifier = 1.0;
            let basicATKModifier = 1.0;
            let buffsList = [];

            if (temporalCompression) {
                atkModifier *= 1.30;
                buffsList.push('<span class="buff-indicator">+30% ATK (Temporal Compression)</span>');
            }
            if (opponentBreezy) {
                atkModifier *= 0.80;
                buffsList.push('<span class="debuff-indicator">-20% ATK (Opponent Breezy)</span>');
            }
            if (gust) {
                atkModifier *= 1.15;
                buffsList.push('<span class="buff-indicator">+15% ATK (Gust)</span>');
            }
            if (coinBomb) {
                basicATKModifier *= 1.35;
                buffsList.push('<span class="buff-indicator">+35% Basic ATK Mult (Coin Bomb)</span>');
            }

            // Apply modifiers
            playerATK *= atkModifier;
            playerBasicATKMult *= basicATKModifier;

            let targetHP;
            let isMaxHP;
            let isCustomScaling = false;

            switch(dmgType) {
                case 'playerMaxHP':
                    targetHP = playerHP;
                    isMaxHP = true;
                    break;
                case 'playerCurrentHP':
                    targetHP = playerHP * (hpPercent / 100);
                    isMaxHP = false;
                    break;
                case 'enemyMaxHP':
                    targetHP = enemyHP;
                    isMaxHP = true;
                    break;
                case 'enemyCurrentHP':
                    targetHP = enemyHP * (hpPercent / 100);
                    isMaxHP = false;
                    break;
                case 'enemyMaxHPPal':
                    targetHP = enemyHP;
                    isMaxHP = true;
                    break;
                case 'customScaling':
                    targetHP = enemyHP; // Default to enemy HP for custom scaling
                    isMaxHP = true; // Treat as max HP for calculation purposes
                    isCustomScaling = true;
                    break;
            }

            const avgLevel = Math.floor((playerLevel + enemyLevel) / 2);
            const pvpFactor = pvpReductionFactors[avgLevel] || 1;

            const hpDamage = targetHP * (hpPerc / 100) * pvpFactor;

            const basicATKDamage = Math.max(1, playerATK - enemyDEF) * (playerBasicATKMult / 100);

            const minDamage = basicATKDamage * 0.8;
            let maxMultiplier;
            
            if (isCustomScaling) {
                maxMultiplier = customScaling;
            } else if (dmgType === 'enemyMaxHPPal') {
                maxMultiplier = 2000;
            } else if (isMaxHP) {
                maxMultiplier = 100;
            } else {
                maxMultiplier = 50;
            }
            
            const maxDamage = basicATKDamage * maxMultiplier;

            let damage;
            let status;
            let cappedStep;

            if (hpDamage <= minDamage) {
                damage = minDamage;
                status = 'Capped at Minimum';
                cappedStep = '7';
            } else if (hpDamage >= maxDamage) {
                damage = maxDamage;
                status = 'Capped at Maximum';
                cappedStep = '8';
            } else {
                damage = hpDamage;
                status = 'Within Range (Not Capped)';
                cappedStep = '5';
            }

            const finalDamage = damage / pvpFactor;
            const uncappedDamage = (targetHP * (hpPerc / 100) * pvpFactor) / pvpFactor;

            // Calculate percentages of target HP (use full HP for percentage calculation)
            const targetHPFull = dmgType.includes('Current') ? 
                (dmgType.includes('player') ? playerHP : enemyHP) : targetHP;
            const finalDamagePercent = (finalDamage / targetHPFull) * 100;
            const uncappedDamagePercent = (uncappedDamage / targetHPFull) * 100;

            document.getElementById('finalDamage').textContent = formatNumber(finalDamage);
            document.getElementById('finalDamagePercent').textContent = finalDamagePercent.toFixed(2) + '%';
            document.getElementById('uncappedDamage').textContent = formatNumber(uncappedDamage);
            document.getElementById('uncappedDamagePercent').textContent = uncappedDamagePercent.toFixed(2) + '%';
            document.getElementById('damageStatus').textContent = status;

            let buffStepsHTML = '';
            if (buffsList.length > 0) {
                buffStepsHTML = `<div class="step"><strong>Active Buffs/Debuffs:</strong><br>${buffsList.join('<br>')}</div>`;
            }

            const hpPercentNote = dmgType.includes('Current') ? ` (${hpPercent}% of max)` : '';

            const stepsHTML = `
                <h4>Calculation Steps:</h4>
                ${buffStepsHTML}
                <div class="step"><strong>1. Target HP:</strong> ${formatNumber(targetHP)}${hpPercentNote} (${dmgType})</div>
                <div class="step"><strong>2. Average Level:</strong> ${avgLevel}</div>
                <div class="step"><strong>3. PvP Reduction Factor:</strong> ${pvpFactor.toFixed(2)}</div>
                <div class="step"><strong>4. HP Damage (Step 1 - Before PvP):</strong> ${formatNumber(targetHP * (hpPerc / 100))}</div>
                <div class="step"><strong>5. HP Damage (Step 2 - After × PvP Factor):</strong> ${formatNumber(hpDamage)}</div>
                <div class="step"><strong>6. Basic ATK Damage:</strong> (${formatNumber(playerATK)} - ${formatNumber(enemyDEF)}) × ${playerBasicATKMult.toFixed(2)}% = ${formatNumber(basicATKDamage)}</div>
                <div class="step"><strong>7. Minimum Damage (0.8×):</strong> ${formatNumber(minDamage)}</div>
                <div class="step"><strong>8. Maximum Damage (${maxMultiplier}×):</strong> ${formatNumber(maxDamage)}</div>
                <div class="step"><strong>9. Capped Damage (Using Step ${cappedStep}):</strong> ${formatNumber(damage)}</div>
                <div class="step"><strong>10. Final Damage (Step 9 ÷ PvP Factor):</strong> ${formatNumber(finalDamage)}</div>
            `;

            document.getElementById('calcSteps').innerHTML = stepsHTML;
            document.getElementById('results').style.display = 'block';
        }
    </script>
</body>
</html>
